 Dashboard (HTTP → DB → WebSocket)

This project receives **HTTP requests** (from Postman), **accumulates Early/Late counts in a database**, and **pushes live updates** to a dashboard page using **WebSockets**.

## Architecture

**Postman (HTTP form-data)** → `POST /api/update` → **DB update (accumulate early/late)** → **WebSocket broadcast** → **Browser UI updates**

---

## Requirements

* **Node.js** (LTS recommended)
* npm (comes with Node)
* Postman (for testing)

---

## Project Files

* `server.js` — HTTP + WebSocket server + DB accumulate + reset endpoint
* `vehicles.db` — SQLite database file (auto created once DB is initialized)
* `car2.html` — Dashboard HTML (your existing UI)
* `car2.js` — Dashboard JS (WebSocket client + UI updates)
* `car2.css` — Dashboard styling (unchanged)

---

## Setup

### 1) Install dependencies

In the project folder:

```bash
npm init -y
npm i express ws cors multer sqlite3
```

---

## Database

This uses **SQLite** (local file DB).

### Create the table (one-time)

If you already have the DB + table, skip this step.

Create `init_db.js`:

```js
const sqlite3 = require("sqlite3").verbose();
const db = new sqlite3.Database("./vehicles.db");

db.serialize(() => {
  db.run(`
    CREATE TABLE IF NOT EXISTS vehicle_stats (
      plate TEXT PRIMARY KEY,
      early INTEGER NOT NULL DEFAULT 0,
      late  INTEGER NOT NULL DEFAULT 0
    )
  `);
  console.log("✅ DB initialized: vehicles.db");
});

db.close();
```

Run:

```bash
node init_db.js
```

This creates `vehicles.db` and the table.

---

## Run the Server

Start the backend:

```bash
node server.js
```

You should see:

* HTTP: `http://localhost:8080`
* WS: `ws://localhost:8080`

Keep this terminal running.

---

## Run the Dashboard (Frontend)

### Option A (Recommended): VS Code Live Server

* Open `car2.html`
* Right click → **Open with Live Server**

### Option B: Simple local server

If you don’t use Live Server:

```bash
npx http-server -p 5500
```

Then open:

* `http://localhost:5500/car2.html`

✅ When opened, the dashboard will connect to:

* `ws://localhost:8080`

---

## API Endpoints

### 1) Update / Accumulate counts

**POST**

```
http://localhost:8080/api/update
```

**Body type:** `form-data`

**Required fields**

* `name` (vehicle number plate)
* `status` (`on_time` or `late`)
  *(or you can send `is_late=true/false` instead of `status` if your server supports it)*

**Optional fields**

* `description` (text)
* `image` (file: png/jpg)

#### What happens

* If `status=on_time` → DB increments **early**
* If `status=late` → DB increments **late**
* Server broadcasts totals to dashboard via WebSocket

---

### 2) Reset / Flush all data

**POST**

```
http://localhost:8080/api/reset
```

**Body:** none required

#### What happens

* DB sets early/late counts to `0` for all rows
* Server broadcasts reset payload to dashboard

---

## Postman Testing

### A) Send an `on_time` event (increments Early)

**POST** `http://localhost:8080/api/update`

**Body → form-data**

| Key         | Type | Example             |
| ----------- | ---- | ------------------- |
| name        | Text | BUS-4587            |
| status      | Text | on_time             |
| description | Text | Arrived on schedule |
| image       | File | (optional png/jpg)  |

Click **Send**.

✅ Dashboard updates:

* Status: “You are on time” (green)
* Early count increases (from DB)

---

### B) Send a `late` event (increments Late)

**POST** `http://localhost:8080/api/update`

**Body → form-data**

| Key         | Type | Example                |
| ----------- | ---- | ---------------------- |
| name        | Text | BUS-4587               |
| status      | Text | late                   |
| description | Text | Delayed due to traffic |

Click **Send**.

✅ Dashboard updates:

* Status: “You are late” (red)
* Late count increases (from DB)

---

### C) Reset all stats

**POST** `http://localhost:8080/api/reset`

No body needed.

✅ Dashboard updates to show counts `0`.

---

## Common Issues

### 1) Dashboard not updating

Check the browser console:

* Should show: `WebSocket: Connected`

Check the server terminal:

* Should show: `✅ WebSocket client connected`

### 2) Port already in use (8080)

Stop the process using the port or change `PORT` in `server.js`.

### 3) Postman image not showing

Make sure:

* Body is `form-data`
* The file field name is exactly: `image`

---

## Notes

* Counts are stored in `vehicles.db` and persist between server restarts.
* The dashboard receives updates as JSON via WebSocket and updates the existing UI elements.

---
